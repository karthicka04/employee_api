<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Delete Employee</title>
    <style>
        /* Add your styles here */
    </style>
</head>
<body>
    <h1>Delete Employee</h1>
    <form method="post" id="csrf-form">
        {% csrf_token %}
    </form>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone Number</th>
                <th>Department</th>
                <th>Salary</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
                <tr id="employee-{{ employee.id }}">
                    <td>{{ employee.name }}</td>
                    <td>{{ employee.phone_number }}</td>
                    <td>{{ employee.department }}</td>
                    <td>{{ employee.salary }}</td>
                    <td>
                        <button onclick="deleteEmployee({{ employee.id }})">Delete</button>
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="5">No employees found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    <div id="message"></div>

    <script>
        function getCsrfToken() {
            const csrfTokenElement = document.querySelector('[name=csrfmiddlewaretoken]');
            return csrfTokenElement ? csrfTokenElement.value : '';
        }

        function deleteEmployee(employeeId) {
    if (confirm('Are you sure you want to delete this employee?')) {
        const deleteUrl = `{% url 'delete_employee_pk' 0 %}`.replace('0', employeeId);
        fetch(deleteUrl, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            }
        })
        .then(response => {
            if (response.ok) {
                // Remove the employee row from the table
                const employeeRow = document.getElementById(`employee-${employeeId}`);
                if (employeeRow) {
                    employeeRow.remove();
                }
                document.getElementById('message').innerText = 'Employee deleted successfully.';
            } else {
                return response.json();
            }
        })
        .then(data => {
            if (data.message) {
                document.getElementById('message').innerText = data.message;
            } else {
                document.getElementById('message').innerText = 'An unknown error occurred.';
            }
        })
        .catch(error => {
            console.error('Error:', error);
            //document.getElementById('message').innerText = 'An error occurred while deleting the employee.';
        });
    }
}
    </script>
</body>
</html>
